# 图书借还系统前端文档

## 1. 项目概述

本文档描述图书借还系统前端的实现细节，包括技术栈、项目结构、功能模块、API接口和部署方式。

### 1.1 技术栈

- **框架**: Vue 3.3.0 (Composition API)
- **路由**: Vue Router 4.2.0
- **状态管理**: Pinia 2.0.0
- **UI组件库**: Element Plus 2.3.0
- **HTTP客户端**: Axios 1.4.0
- **图表库**: ECharts 6.0.0
- **构建工具**: Vite 5.0.0
- **CSS预处理器**: Sass 1.96.0

### 1.2 项目结构

```
library-frontend/
├── src/
│   ├── api/              # API接口封装
│   │   ├── auth.js       # 认证相关接口
│   │   ├── book.js       # 图书相关接口
│   │   ├── borrow.js     # 借阅相关接口
│   │   ├── reader.js     # 读者相关接口
│   │   ├── request.js    # Axios请求配置
│   │   └── statistics.js # 统计相关接口
│   ├── assets/           # 静态资源
│   │   └── bg-library-login.jpg
│   ├── components/       # 公共组件
│   │   ├── BookCard.vue      # 图书卡片
│   │   ├── BookForm.vue      # 图书表单
│   │   ├── ConfirmDialog.vue # 确认对话框
│   │   ├── DataTable.vue     # 数据表格
│   │   ├── Layout.vue        # 布局组件
│   │   ├── ReaderCard.vue    # 读者卡片
│   │   ├── ReaderForm.vue    # 读者表单
│   │   ├── ReceiptDialog.vue # 收据对话框
│   │   └── SearchForm.vue    # 搜索表单
│   ├── router/           # 路由配置
│   │   └── index.js
│   ├── stores/           # Pinia状态管理
│   │   ├── auth.js       # 认证状态
│   │   ├── borrow.js     # 借阅状态
│   │   └── ui.js         # UI状态
│   ├── styles/           # 全局样式
│   │   ├── global.scss   # 全局样式
│   │   ├── login.scss    # 登录页样式
│   │   ├── print-ticket.css # 打印样式
│   │   └── variables.scss # 变量定义
│   ├── utils/            # 工具函数
│   │   ├── csv.js        # CSV处理
│   │   └── echartsHelper.js # ECharts辅助函数
│   ├── views/            # 页面组件
│   │   ├── BookDetail.vue     # 图书详情
│   │   ├── BookList.vue       # 图书列表
│   │   ├── BorrowHistory.vue  # 借阅历史
│   │   ├── BorrowPage.vue     # 借书页面
│   │   ├── Dashboard.vue      # 仪表盘
│   │   ├── Login.vue          # 登录页面
│   │   ├── OverdueRecords.vue # 逾期记录
│   │   ├── ReaderDetail.vue   # 读者详情
│   │   ├── ReaderList.vue     # 读者列表
│   │   ├── ReturnPage.vue     # 还书页面
│   │   ├── Settings.vue       # 设置页面
│   │   └── Statistics.vue     # 统计页面
│   ├── App.vue           # 根组件
│   └── main.js           # 入口文件
├── dist/                 # 构建输出
├── node_modules/         # 依赖包
├── public/               # 公共资源
├── index.html            # HTML模板
├── package.json          # 项目配置
└── README.md             # 项目文档
```

## 2. 路由与页面映射

系统采用基于Vue Router的单页应用架构，所有页面组件位于`src/views`目录下，路由配置在`src/router/index.js`中定义。

| 路径 | 组件 | 功能描述 | 是否需要认证 |
|------|------|----------|--------------|
| `/` | 重定向到`/login` | 根路径重定向 | 否 |
| `/login` | `Login.vue` | 用户登录 | 否 |
| `/dashboard` | `Dashboard.vue` | 系统仪表盘 | 是 |
| `/books` | `BookList.vue` | 图书列表 | 是 |
| `/books/:id` | `BookDetail.vue` | 图书详情 | 是 |
| `/readers` | `ReaderList.vue` | 读者列表 | 是 |
| `/readers/:id` | `ReaderDetail.vue` | 读者详情 | 是 |
| `/borrow` | `BorrowPage.vue` | 借书操作 | 是 |
| `/return` | `ReturnPage.vue` | 还书操作 | 是 |
| `/borrow-history` | `BorrowHistory.vue` | 借阅历史 | 是 |
| `/overdue-records` | `OverdueRecords.vue` | 逾期记录 | 是 |
| `/statistics` | `Statistics.vue` | 数据统计 | 是 |
| `/settings` | `Settings.vue` | 系统设置 | 是 |

### 2.1 路由守卫

系统实现了基于Token的认证机制，通过路由守卫控制页面访问权限：

1. 所有非登录页面都需要认证(`meta: { requiresAuth: true }`)
2. 未认证用户访问受保护页面时，会重定向到登录页，并携带原始路径作为查询参数
3. 登录页面始终允许访问
4. Token存储在localStorage中，并在Axios请求拦截器中自动添加到请求头

## 3. 状态管理

系统使用Pinia进行状态管理，主要包含以下store：

### 3.1 认证状态 (`stores/auth.js`)

管理用户登录状态、用户信息和Token：

```javascript
// 状态
{
  user: null,         // 用户信息
  token: '',          // JWT Token
  isLoggedIn: false   // 登录状态
}

// 主要方法
login(payload)        // 用户登录
logout()              // 用户登出
loadFromStorage()     // 从localStorage加载状态
```

### 3.2 借阅状态 (`stores/borrow.js`)

管理借书过程中的临时状态：

```javascript
// 状态
{
  selectedReader: null,    // 选中的读者
  selectedBooks: [],       // 选中的图书
  step: 1                  // 当前步骤
}

// 主要方法
addBook(book)              // 添加图书到借书篮
removeBook(bookId)         // 从借书篮移除图书
clearSelection()           // 清空选择
setReader(reader)          // 设置选中读者
```

### 3.3 UI状态 (`stores/ui.js`)

管理UI相关的全局状态：

```javascript
// 状态
{
  sidebarCollapsed: false, // 侧边栏折叠状态
  theme: 'light'           // 主题设置
}
```

## 4. API接口设计

系统采用RESTful API设计，所有API接口封装在`src/api`目录下，通过Axios实例进行HTTP请求。

### 4.1 请求配置 (`api/request.js`)

- 基础URL: `/api`
- 超时时间: 10秒
- 自动添加Token到请求头
- 自动处理分页参数转换(page/size -> offset/limit)
- 统一错误处理，401状态自动跳转登录页

### 4.2 认证接口 (`api/auth.js`)

```javascript
// 登录
POST /api/auth/login
请求体: { username: string, password: string }
响应: { code: 0, message: 'ok', data: { token: string, user: object } }

// 登出
POST /api/auth/logout
响应: { code: 0, message: 'ok' }
```

### 4.3 图书接口 (`api/book.js`)

```javascript
// 获取图书列表
GET /api/books?page=1&size=20&search=keyword&author=author&category=category
响应: { code: 0, data: { items: Book[], total: number } }

// 获取图书详情
GET /api/books/:id
响应: { code: 0, data: Book }

// 创建图书
POST /api/books
请求体: Book
响应: { code: 0, message: 'ok', data: Book }

// 更新图书
PUT /api/books/:id
请求体: Book
响应: { code: 0, message: 'ok', data: Book }

// 删除图书
DELETE /api/books/:id
响应: { code: 0, message: 'ok' }

// 调整图书库存
PATCH /api/books/:id/stock
请求体: { adjustment: number }
响应: { code: 0, message: 'ok', data: Book }
```

### 4.4 读者接口 (`api/reader.js`)

```javascript
// 获取读者列表
GET /api/readers?page=1&size=20&search=keyword
响应: { code: 0, data: { items: Reader[], total: number } }

// 获取读者详情
GET /api/readers/:id
响应: { code: 0, data: Reader }

// 创建读者
POST /api/readers
请求体: Reader
响应: { code: 0, message: 'ok', data: Reader }

// 更新读者
PUT /api/readers/:id
请求体: Reader
响应: { code: 0, message: 'ok', data: Reader }

// 删除读者
DELETE /api/readers/:id
响应: { code: 0, message: 'ok' }

// 更新读者状态
PATCH /api/readers/:id/status
请求体: { status: string }
响应: { code: 0, message: 'ok' }

// 根据卡号获取读者
GET /api/readers/byCard/:cardNumber
响应: { code: 0, data: Reader }
```

### 4.5 借阅接口 (`api/borrow.js`)

```javascript
// 借书
POST /api/borrow
请求体: { readerId: number, books: [{ bookId: number, count: number }], borrowDate: string, dueDate: string }
响应: { code: 0, data: { borrowId: number, receipt: object } }

// 还书
POST /api/return
请求体: { borrowIds: number[], returnDate: string }
响应: { code: 0, data: { returned: object[], fines: object[] } }

// 获取借阅记录
GET /api/borrow?readerId=123&status=borrowed&page=1&size=20
响应: { code: 0, data: { items: Borrow[], total: number } }

// 获取最近借阅
GET /api/borrow/recent?limit=10
响应: { code: 0, data: Borrow[] }
```

### 4.6 统计接口 (`api/statistics.js`)

```javascript
// 获取概览统计
GET /api/statistics/overview
响应: { code: 0, data: { totalBooks: number, totalReaders: number, borrowedCount: number, todayBorrows: number, todayReturns: number, overdueCount: number } }

// 获取热门图书
GET /api/statistics/popular-books?top=10
响应: { code: 0, data: Book[] }

// 获取逾期图书
GET /api/statistics/overdue-books?page=1&size=20
响应: { code: 0, data: { items: Book[], total: number } }

// 获取读者借阅详情
GET /api/statistics/borrow-details/:readerId
响应: { code: 0, data: Borrow[] }
```

## 5. 核心功能模块

### 5.1 登录模块 (`Login.vue`)

- **功能**: 用户凭用户名/密码登录并获得Token
- **布局**: 表单居中，宽度380px，包含logo、用户名输入、密码输入、登录按钮
- **表单字段**:
  - username: required, min 3, max 50
  - password: required, min 6
- **API**: POST `/api/auth/login`
- **流程**:
  1. 用户输入用户名和密码
  2. 点击登录按钮，调用登录API
  3. 登录成功后，保存Token和用户信息到localStorage和Pinia store
  4. 跳转到仪表盘页面
- **错误处理**: 登录失败时显示错误消息，登录按钮在请求期间显示loading并禁用

### 5.2 仪表盘 (`Dashboard.vue`)

- **功能**: 展示关键统计与近期活动
- **布局**: 
  - 顶部为欢迎与KPI卡片（网格3~4列）
  - 下方分两列：左侧热门图书/图表，右侧最近借阅/逾期列表
- **展示项**:
  - 总图书数量 (totalBooks)
  - 总读者数量 (totalReaders)
  - 当前在借图书数量 (borrowedCount)
  - 今日借书次数 (todayBorrows)
  - 今日还书次数 (todayReturns)
  - 逾期未还图书数量 (overdueCount)
- **组件**: ElCard、ElRow、ElCol、BookCard、ECharts、DataTable
- **API**: 
  - GET `/api/statistics/overview`
  - GET `/api/statistics/popular-books?top=10`
  - GET `/api/borrow/recent?limit=10`
- **交互**: 点击热门图书跳转到图书列表页面并预填搜索关键字

### 5.3 图书管理 (`BookList.vue`)

- **功能**: 图书CRUD、搜索、分页、排序
- **布局**: 顶栏SearchForm + 操作按钮（新增图书），下方为DataTable
- **展示字段**:
  - checkbox（多选）
  - cover (缩略图)
  - title
  - author
  - publisher
  - publishDate (YYYY-MM-DD)
  - category
  - location
  - totalCopies
  - availableCopies
  - actions (查看/编辑/删除/库存调整)
- **组件**: SearchForm、DataTable、ElButton、ElDialog、ElUpload
- **API**:
  - GET `/api/books?page=&size=&search=&author=&category=`
  - POST `/api/books`
  - PUT `/api/books/:id`
  - DELETE `/api/books/:id`
  - PATCH `/api/books/:id/stock`
- **表单字段与校验**:
  - title: required
  - author: required
  - isbn: format
  - publisher: optional
  - publishDate: date
  - category: optional
  - location: optional
  - totalCopies: number >= 0
- **操作UX**: 
  - 删除需ConfirmDialog确认
  - 编辑在弹窗中进行
  - 新增成功后列表刷新并提示

### 5.4 读者管理 (`ReaderList.vue`)

- **功能**: 读者信息管理
- **布局**: 顶部SearchForm + 新增按钮，下方DataTable
- **展示字段**:
  - checkbox
  - name
  - idType
  - idNumber
  - phone
  - registerDate
  - status (active/forbidden)
  - borrowLimit
  - currentBorrowCount
  - actions (edit/delete)
- **组件**: SearchForm、DataTable、ElDialog、ReaderCard
- **API**: GET/POST/PUT/DELETE `/api/readers` 等
- **表单校验**:
  - name: required
  - idNumber: required + regex
  - phone: regex
  - borrowLimit: integer >= 0
- **特殊操作**: 
  - 冻结/恢复用户通过PATCH `/api/readers/:id/status`
  - 在UI中即时反映状态变化

### 5.5 借书 (`BorrowPage.vue`)

- **功能**: 办理借书手续并生成借阅凭证
- **流程**: 三步式（Step1 选择读者 -> Step2 选择图书 -> Step3 确认并提交）
- **布局**:
  - 左侧或顶部显示步骤进度条（ElSteps）
  - 中央为当前步骤表单/列表
  - 右侧为借书篮（selectedBooks）概要
- **Step1**: 选择/验证读者
  - 输入卡号/证件号，调用GET `/api/readers/byCard/:cardNumber`
  - 展示读者信息（姓名、状态、当前借书数、借书上限）
  - 若读者不存在或被禁用，显示错误并阻止下一步
- **Step2**: 搜索并选择图书
  - 使用SearchForm搜索，DataTable列出结果
  - 操作列提供"加入借书篮"按钮（若availableCopies>0）
  - 更新stores/borrow.selectedBooks，检查重复与数量
- **Step3**: 确认并提交
  - 显示读者与图书信息摘要
  - 借出日期默认今日，应还日期 = 今日 + N天
  - 提交POST `/api/borrow`
  - 成功后返回borrowId与凭证信息，展示成功页面/弹窗
- **组件**: SearchForm、DataTable、ElSteps、ElForm、ElButton
- **校验**:
  - 读者借书是否已达上限
  - 图书availability re-check（提交前再次查询后端确保库存）

### 5.6 还书 (`ReturnPage.vue`)

- **功能**: 处理归还，计算逾期与罚款
- **流程**: 输入读者 -> 列出在借记录 -> 选择需要归还的条目 -> 确认归还
- **页面字段**:
  - 借阅记录表格（借阅编号、书名、借出日期、应还日期、逾期天数、应罚款、操作复选框）
- **API**:
  - GET `/api/borrow?readerId=...&status=borrowed` 获取在借记录
  - POST `/api/return` 请求体 { borrowIds: [..], returnDate }
- **提交后**:
  - 更新Book在馆数
  - Borrow记录状态到returned
  - 显示归还收据（包含罚款金额）
- **组件**: SearchForm、DataTable、ElForm、ConfirmDialog、ElButton

### 5.7 统计查询 (`Statistics.vue`)

- **功能**: 按维度查看统计数据与导出
- **布局**: 顶部为时间筛选器（日期范围），下方为Tab（热门图书 / 数据详情）
- **热门图书**: ECharts柱状图 + DataTable明细
- **数据详情**: DataTable（支持导出CSV）
- **组件**: ElTabs、ECharts、DataTable、ElDatePicker、ElButton
- **API**:
  - GET `/api/statistics/popular-books?top=10`
  - GET `/api/statistics/overdue-books?page=1&size=20`

### 5.8 借阅历史 (`BorrowHistory.vue`)

- **功能**: 查看借阅历史记录
- **布局**: 顶部搜索表单，下方数据表格
- **展示字段**:
  - 借阅编号
  - 读者姓名
  - 图书名称
  - 借出日期
  - 应还日期
  - 实际归还日期
  - 状态（借出中/已归还/逾期）
- **组件**: SearchForm、DataTable
- **API**: GET `/api/borrow?readerId=...&status=...&page=1&size=20`

### 5.9 逾期记录 (`OverdueRecords.vue`)

- **功能**: 查看逾期未还记录
- **布局**: 顶部搜索表单，下方数据表格
- **展示字段**:
  - 借阅编号
  - 读者姓名
  - 图书名称
  - 借出日期
  - 应还日期
  - 逾期天数
  - 应罚款
- **组件**: SearchForm、DataTable
- **API**: GET `/api/statistics/overdue-books?page=1&size=20`

### 5.10 设置 (`Settings.vue`)

- **功能**: 系统设置与配置
- **布局**: 表单形式展示各项设置
- **设置项**:
  - 借阅期限（天数）
  - 最大借书数量
  - 逾期罚款规则
  - 系统通知设置
- **组件**: ElForm、ElFormItem、ElInput、ElSwitch
- **API**: GET/POST `/api/settings`

## 6. 公共组件

### 6.1 布局组件 (`Layout.vue`)

- **结构**:
  - Header（顶部）: logo、系统名、用户下拉（个人资料、登出）
  - Sidebar（左侧）: 功能导航（可折叠）
  - Main（右侧主区）: 面包屑 + 路由渲染区
  - Footer（底部）: 版权、版本信息
- **响应式**: 小于768px时侧边栏自动隐藏，主菜单通过汉堡按钮展示

### 6.2 数据表格 (`DataTable.vue`)

- **Props**: 
  - columns: 列配置
  - data: 表格数据
  - total: 总记录数
  - page: 当前页码
  - pageSize: 每页大小
  - loading: 加载状态
- **Events**:
  - page-change: 页码变化
  - sort-change: 排序变化
  - selection-change: 选择变化
  - action: 操作按钮点击
- **功能**:
  - 分页
  - 排序
  - 多选
  - 操作按钮
  - 自定义列渲染

### 6.3 搜索表单 (`SearchForm.vue`)

- **Props**:
  - schema: 表单配置
  - value: 表单值
- **Events**:
  - search: 搜索事件
- **功能**:
  - 动态表单生成
  - 表单验证
  - 重置功能
  - 防抖搜索

### 6.4 确认对话框 (`ConfirmDialog.vue`)

- **Props**:
  - visible: 是否显示
  - title: 对话框标题
  - content: 对话框内容
- **Events**:
  - confirm: 确认事件
  - cancel: 取消事件
- **功能**:
  - 确认/取消操作
  - 自定义内容

### 6.5 图书卡片 (`BookCard.vue`)

- **Props**:
  - book: 图书信息
  - showActions: 是否显示操作按钮
- **Events**:
  - click: 点击事件
  - action: 操作事件
- **功能**:
  - 展示图书基本信息
  - 操作按钮（借阅、编辑等）

### 6.6 读者卡片 (`ReaderCard.vue`)

- **Props**:
  - reader: 读者信息
  - showActions: 是否显示操作按钮
- **Events**:
  - click: 点击事件
  - action: 操作事件
- **功能**:
  - 展示读者基本信息
  - 操作按钮（借阅、编辑等）

### 6.7 图书表单 (`BookForm.vue`)

- **Props**:
  - book: 图书信息
  - mode: 表单模式（create/edit）
- **Events**:
  - submit: 提交事件
  - cancel: 取消事件
- **功能**:
  - 图书信息编辑
  - 表单验证
  - 封面上传

### 6.8 读者表单 (`ReaderForm.vue`)

- **Props**:
  - reader: 读者信息
  - mode: 表单模式（create/edit）
- **Events**:
  - submit: 提交事件
  - cancel: 取消事件
- **功能**:
  - 读者信息编辑
  - 表单验证

### 6.9 收据对话框 (`ReceiptDialog.vue`)

- **Props**:
  - visible: 是否显示
  - receipt: 收据信息
  - type: 收据类型（borrow/return）
- **Events**:
  - close: 关闭事件
  - print: 打印事件
- **功能**:
  - 展示借阅/归还收据
  - 打印功能

## 7. 工具函数

### 7.1 CSV处理 (`utils/csv.js`)

- **功能**:
  - 导出CSV文件
  - 解析CSV文件
- **方法**:
  - exportToCsv(data, filename)
  - parseCsv(file)

### 7.2 ECharts辅助函数 (`utils/echartsHelper.js`)

- **功能**:
  - 生成图表配置
  - 图表主题设置
- **方法**:
  - getBarChartOption(data, options)
  - getPieChartOption(data, options)
  - getLineChartOption(data, options)

## 8. 样式系统

### 8.1 全局样式 (`styles/global.scss`)

- **功能**:
  - 全局样式重置
  - 通用样式类
  - 响应式布局

### 8.2 变量定义 (`styles/variables.scss`)

- **功能**:
  - 颜色变量
  - 尺寸变量
  - 字体变量

### 8.3 登录页样式 (`styles/login.scss`)

- **功能**:
  - 登录页面特定样式
  - 背景图片处理

### 8.4 打印样式 (`styles/print-ticket.css`)

- **功能**:
  - 收据打印样式
  - 打印媒体查询

## 9. 构建与部署

### 9.1 开发环境

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 9.2 生产构建

```bash
# 构建生产版本
npm run build

# 预览构建结果
npm run preview
```

### 9.3 部署建议

- 使用Nginx作为静态资源服务器
- 配置HTTPS
- 启用Gzip压缩
- 设置适当的缓存策略
- 配置反向代理到后端API

## 10. 性能优化

### 10.1 代码分割

- 使用Vue Router的懒加载
- 按需加载ECharts组件
- 动态导入第三方库

### 10.2 数据优化

- 使用服务端分页
- 实现数据缓存
- 防抖搜索

### 10.3 资源优化

- 图片懒加载
- 静态资源压缩
- 使用CDN加速

## 11. 安全考虑

### 11.1 认证与授权

- JWT Token认证
- 路由级权限控制
- API请求拦截器

### 11.2 数据安全

- 敏感数据脱敏
- XSS防护
- CSRF防护

### 11.3 前端安全

- 输入验证
- 输出编码
- 安全的第三方库使用

## 12. 测试策略

### 12.1 单元测试

- 使用Jest进行单元测试
- 测试组件逻辑
- 测试工具函数

### 12.2 集成测试

- 使用Cypress进行E2E测试
- 测试关键业务流程
- 测试用户交互

### 12.3 测试覆盖

- 核心功能测试覆盖
- 边界情况测试
- 错误处理测试

## 13. 常见问题与解决方案

### 13.1 登录问题

- **问题**: 登录后页面刷新导致登录状态丢失
- **解决方案**: 在App.vue中调用auth.loadFromStorage()恢复登录状态

### 13.2 分页问题

- **问题**: 前端分页参数与后端不一致
- **解决方案**: 在request.js中自动将page/size转换为offset/limit

### 13.3 图表渲染问题

- **问题**: ECharts图表在Tab中不显示
- **解决方案**: 使用v-if或nextTick确保DOM元素已渲染

### 13.4 打印样式问题

- **问题**: 打印收据时样式不正确
- **解决方案**: 使用专门的打印样式表和媒体查询

## 14. 未来扩展计划

### 14.1 功能扩展

- 移动端适配
- 离线支持
- 多语言支持

### 14.2 技术升级

- 升级到Vue 3.4+
- 引入TypeScript
- 使用Vite PWA插件

### 14.3 性能优化

- 虚拟滚动
- 图片优化
- 代码分割优化

## 15. 结语

本文档详细描述了图书借还系统前端的实现细节，包括技术栈、项目结构、功能模块、API接口和部署方式。随着项目的发展，本文档将不断更新和完善，以确保其与实际代码保持同步。

如有任何问题或建议，请联系开发团队。