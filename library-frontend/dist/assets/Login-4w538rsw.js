import{r as n,q as L,x as q,z as f,P as o,H as l,ay as s,aZ as B,a_ as I,y as g,u as M,G as N,J as R,ap as y,L as w,M as K}from"./vendor_vue-DcrwGJHO.js";import{u as A}from"./index-xceKWyYj.js";import{u as D}from"./vendor_element-BfRFdgV9.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor_misc-BnRtHUQB.js";const G={class:"login-page"},H={class:"login-header"},J={__name:"Login",setup(P){const v=n(null),a=n({username:"",password:""}),V={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},u=n(!1),b=A(),k=B(),x=I(),d=n(!1),r=n("");L(()=>{const i=localStorage.getItem("savedUsername");i&&(a.value.username=i,d.value=!0)});async function c(){if(await v.value.validate().catch(()=>!1)){u.value=!0,r.value="";try{const e=await b.login({username:a.value.username,password:a.value.password});if(e&&e.code===0){d.value?localStorage.setItem("savedUsername",a.value.username):localStorage.removeItem("savedUsername");const p=x.query.redirect||"/dashboard";k.push(p)}else r.value=(e==null?void 0:e.message)||"登录失败"}catch(e){r.value="网络错误，请稍后重试",console.error("Login error:",e)}finally{u.value=!1}}}return(i,e)=>{const p=s("el-avatar"),_=s("el-input"),m=s("el-form-item"),U=s("el-checkbox"),h=s("el-button"),S=s("el-alert"),z=s("el-form"),C=s("el-card");return g(),q("div",G,[e[6]||(e[6]=f("div",{class:"login-background"},null,-1)),o(C,{class:"login-card"},{default:l(()=>[f("div",H,[o(p,{icon:M(D),size:"large",class:"login-avatar"},null,8,["icon"]),e[4]||(e[4]=f("h3",null,"图书借还管理系统",-1))]),o(z,{model:a.value,rules:V,ref_key:"formRef",ref:v,class:"login-form"},{default:l(()=>[o(m,{prop:"username"},{default:l(()=>[o(_,{modelValue:a.value.username,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.username=t),placeholder:"用户名",size:"large","prefix-icon":"User",onKeyup:y(c,["enter"])},null,8,["modelValue"])]),_:1}),o(m,{prop:"password"},{default:l(()=>[o(_,{modelValue:a.value.password,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.password=t),type:"password",placeholder:"密码",size:"large","prefix-icon":"Lock","show-password":"",onKeyup:y(c,["enter"])},null,8,["modelValue"])]),_:1}),o(m,null,{default:l(()=>[o(U,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=t=>d.value=t)},{default:l(()=>[...e[5]||(e[5]=[w("记住用户名",-1)])]),_:1},8,["modelValue"])]),_:1}),o(m,null,{default:l(()=>[o(h,{type:"primary",loading:u.value,onClick:c,size:"large",class:"login-button",style:{width:"100%"}},{default:l(()=>[w(K(u.value?"登录中...":"登录"),1)]),_:1},8,["loading"])]),_:1}),r.value?(g(),N(S,{key:0,title:r.value,type:"error","show-icon":"",closable:"",onClose:e[3]||(e[3]=t=>r.value="")},null,8,["title"])):R("",!0)]),_:1},8,["model"])]),_:1})])}}},O=E(J,[["__scopeId","data-v-d4123700"]]);export{O as default};
