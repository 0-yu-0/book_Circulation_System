import{L as q}from"./Layout-BdsSE8cV.js";import{_ as z}from"./DataTable-MJnSbYJK.js";import{S as F}from"./SearchForm-aUpadHZH.js";import{r as m,Z as O,o as P,ay as u,G as S,y as D,H as t,P as e,L as b,u as M,z as R,M as G,q as H}from"./vendor_vue-CyXBEfF2.js";import{f as Z,u as A,c as E,d as I}from"./reader-ByGKMhQ5.js";import"./vendor_misc-Dn7xwPo7.js";import"./index-C-RrEStG.js";import"./vendor_element-DkqkCxjX.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={__name:"ReaderForm",props:{visible:Boolean,reader:Object},emits:["save","cancel"],setup(v,{emit:d}){const i=v,f=d,p=m(null),V=i.reader?"edit":"create",o=O({id:null,name:"",idType:"身份证",idNumber:"",phone:"",borrowLimit:5}),C={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],idNumber:[{required:!0,message:"请输入证件号",trigger:"blur"}]};P(()=>i.reader,s=>{s?Object.assign(o,s):Object.assign(o,{id:null,name:"",idType:"身份证",idNumber:"",phone:"",borrowLimit:5})});function _(){p.value.validate(s=>{s&&f("save",{...o})})}return(s,l)=>{const g=u("el-input"),c=u("el-form-item"),$=u("el-input-number"),N=u("el-form"),w=u("el-button"),x=u("el-dialog");return D(),S(x,{title:M(V)==="edit"?"编辑读者":"新增读者",visible:v.visible},{footer:t(()=>[e(w,{onClick:l[5]||(l[5]=r=>s.$emit("cancel"))},{default:t(()=>[...l[6]||(l[6]=[b("取消",-1)])]),_:1}),e(w,{type:"primary",onClick:_},{default:t(()=>[...l[7]||(l[7]=[b("保存",-1)])]),_:1})]),default:t(()=>[e(N,{model:o,rules:C,ref_key:"formRef",ref:p,"label-width":"110px"},{default:t(()=>[e(c,{label:"姓名",prop:"name"},{default:t(()=>[e(g,{modelValue:o.name,"onUpdate:modelValue":l[0]||(l[0]=r=>o.name=r)},null,8,["modelValue"])]),_:1}),e(c,{label:"证件类型",prop:"idType"},{default:t(()=>[e(g,{modelValue:o.idType,"onUpdate:modelValue":l[1]||(l[1]=r=>o.idType=r)},null,8,["modelValue"])]),_:1}),e(c,{label:"证件号",prop:"idNumber"},{default:t(()=>[e(g,{modelValue:o.idNumber,"onUpdate:modelValue":l[2]||(l[2]=r=>o.idNumber=r)},null,8,["modelValue"])]),_:1}),e(c,{label:"电话",prop:"phone"},{default:t(()=>[e(g,{modelValue:o.phone,"onUpdate:modelValue":l[3]||(l[3]=r=>o.phone=r)},null,8,["modelValue"])]),_:1}),e(c,{label:"可借书数",prop:"borrowLimit"},{default:t(()=>[e($,{modelValue:o.borrowLimit,"onUpdate:modelValue":l[4]||(l[4]=r=>o.borrowLimit=r),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","visible"])}}},K={__name:"ConfirmDialog",props:{visible:Boolean,message:{type:String,default:"确认执行此操作？"}},setup(v){return(d,i)=>{const f=u("el-button"),p=u("el-dialog");return D(),S(p,{visible:v.visible,width:"400px"},{footer:t(()=>[e(f,{onClick:i[0]||(i[0]=V=>d.$emit("cancel"))},{default:t(()=>[...i[2]||(i[2]=[b("取消",-1)])]),_:1}),e(f,{type:"primary",onClick:i[1]||(i[1]=V=>d.$emit("confirm"))},{default:t(()=>[...i[3]||(i[3]=[b("确认",-1)])]),_:1})]),default:t(()=>[R("span",null,G(v.message),1)]),_:1},8,["visible"])}}},Q={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"12px"}},ae={__name:"ReaderList",setup(v){const d=m({search:""}),i=m([]),f=m(0),p=m(1),V=m(20),o=m(!1),C=m(null),_=m(!1),s=m(null);async function l(){const n=await Z({page:p.value,size:V.value,search:d.value.search});n&&n.code===0&&(i.value=n.data.items,f.value=n.data.total)}H(l);function g(){p.value=1,l()}function c(n){p.value=n,l()}function $(){C.value=null,o.value=!0}function N(n){C.value={...n},o.value=!0}function w(){o.value=!1}async function x(n){if(n.id){const a=await A(n.id,n);a&&a.code===0&&(o.value=!1,l())}else{const a=await E(n);a&&a.code===0&&(o.value=!1,l())}}function r(n){s.value=n,_.value=!0}async function T(){if(!s.value)return;const n=await I(s.value.id);n&&n.code===0&&(_.value=!1,l())}return(n,a)=>{const U=u("el-input"),B=u("el-form-item"),L=u("el-button"),y=u("el-table-column");return D(),S(q,null,{default:t(()=>[R("div",Q,[e(F,{onSearch:g},{fields:t(()=>[e(B,null,{default:t(()=>[e(U,{modelValue:d.value.search,"onUpdate:modelValue":a[0]||(a[0]=k=>d.value.search=k),placeholder:"姓名/证件号"},null,8,["modelValue"])]),_:1})]),_:1}),R("div",null,[e(L,{type:"primary",onClick:$},{default:t(()=>[...a[2]||(a[2]=[b("新增读者",-1)])]),_:1})])]),e(z,{data:i.value,total:f.value,onPageChange:c},{columns:t(()=>[e(y,{prop:"name",label:"姓名"}),e(y,{prop:"idNumber",label:"证件号"}),e(y,{prop:"phone",label:"电话"}),e(y,{prop:"registerDate",label:"注册日期"}),e(y,{prop:"status",label:"状态"}),e(y,{label:"操作"},{default:t(({row:k})=>[e(L,{type:"text",onClick:j=>N(k)},{default:t(()=>[...a[3]||(a[3]=[b("编辑",-1)])]),_:1},8,["onClick"]),e(L,{type:"text",onClick:j=>r(k)},{default:t(()=>[...a[4]||(a[4]=[b("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","total"]),e(J,{visible:o.value,reader:C.value,onSave:x,onCancel:w},null,8,["visible","reader"]),e(K,{visible:_.value,message:"确认删除该读者吗？",onConfirm:T,onCancel:a[1]||(a[1]=()=>{_.value=!1})},null,8,["visible"])]),_:1})}}};export{ae as default};
